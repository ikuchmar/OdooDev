
# Проверить и вернуть базу из SINGLE_USER в MULTI_USER (SQL Server)


Посмотреть режим доступа:
=============================================

SELECT name, user_access_desc, state_desc
FROM sys.databases
WHERE name = N'ИмяВашейБазы';


Насильно перевести в многопользовательский режим (с оборотом открытых транзакций):
=============================================
ALTER DATABASE [ИмяВашейБазы]
SET MULTI_USER WITH ROLLBACK IMMEDIATE;


Если кто-то “перехватывает” единственное подключение в SINGLE_USER, выполняйте команду через DAC (админ-подключение):
в SSMS — ADMIN:ИмяСервера, или в консоли:
sqlcmd -S admin:ИмяСервера -E

(Опционально) Найти и прибить помехающие сессии:
=============================================

SELECT s.session_id, s.login_name, s.host_name, s.program_name
FROM sys.dm_exec_sessions s
WHERE s.database_id = DB_ID(N'ИмяВашейБазы');

-- завершить конкретную сессию:
=============================================
KILL 57;  -- подставьте session_id


# Полезные проверки:

-- висящие транзакции
=============================================
DBCC OPENTRAN (N'ИмяВашейБазы');

-- отключить авто-закрытие (может мешать)
=============================================
ALTER DATABASE [ИмяВашейБазы] SET AUTO_CLOSE OFF;

-- убедиться, что не Restricted:
=============================================
ALTER DATABASE [ИмяВашейБазы] SET RESTRICTED_USER OFF;