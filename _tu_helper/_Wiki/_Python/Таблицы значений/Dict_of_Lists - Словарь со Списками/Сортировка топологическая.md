из списка словарей, где в словаре перечень ключей от которых зависит текущий ключ
depends_1 = {
    'm5': ['m1'],
    'm2': ['m3'],
    'm4': ['m3'],
    'm1': ['m2', 'm3'],
    'm3': [],
} 
получить списка словарей, в порядке убывания зависимостей
depends_2 = {
    'm3': [],
    'm4': ['m3'],
    'm2': ['m3'],
    'm1': ['m2', 'm3'],
    'm5': ['m1'],
}


Для получения списка словарей depends_2 с упорядоченными зависимостями, можно использовать алгоритм сортировки топологического порядка.


from collections import defaultdict

def topological_sort(dependencies):
    # Создаем словарь для хранения посещенных узлов
    visited = defaultdict(bool)

    # Создаем список для сохранения упорядоченных зависимостей
    result = []

    # Рекурсивная функция для обхода узлов в глубину
    def dfs(node):
        # Помечаем текущий узел как посещенный
        visited[node] = True

        # Рекурсивно обходим зависимости текущего узла
        if node in dependencies:
            for dependency in dependencies[node]:
                # Если зависимость не была посещена, вызываем функцию dfs для нее
                if not visited[dependency]:
                    dfs(dependency)

        # Добавляем текущий узел в начало списка результата
        result.insert(0, node)

    # Обходим все узлы словаря dependencies
    for node in dependencies:
        # Если узел не был посещен, вызываем функцию dfs для него
        if not visited[node]:
            dfs(node)

    return result

# Исходный словарь с зависимостями
depends_1 = {
    'm5': ['m1'],
    'm2': ['m3'],
    'm4': ['m3'],
    'm1': ['m2', 'm3'],
    'm3': [],
}

# Получаем упорядоченные зависимости
ordered_dependencies = topological_sort(depends_1)

# Создаем новый словарь depends_2 с упорядоченными зависимостями
depends_2 = {}
for node in ordered_dependencies:
    depends_2[node] = depends_1.get(node, [])

print(depends_2)
Результат выполнения кода:

arduino
Copy code
{
    'm3': [],
    'm4': ['m3'],
    'm2': ['m3'],
    'm1': ['m2', 'm3'],
    'm5': ['m1']
}
В полученном словаре depends_2 зависимости упорядочены в порядке убывания зависимостей. Узлы без зависимостей расположены в начале словаря, а затем идут узлы, которые зависят от предыдущих узлов.