Мастер-промт (как я понял задачу)

Собери одно видео из набора изображений, где для каждой картинки задана абсолютная дорога (полный путь) и своя длительность (в секундах). Скрипт должен запускаться «как есть» (двойной клик/из командной строки без параметров); все настройки и список изображений — в config.toml, который лежит рядом со скриптом. Скрипт обязан:

прочитать список картинок и их длительностей из config.toml,

уложить каждую картинку в заданное разрешение (с сохранением пропорций и подкладкой фона),

склеить всё в один видеофайл,

корректно обработать пробелы/кириллицу в путях,

опционально примиксовать аудиодорожку,

выдать понятный лог и сообщения об ошибках.

ТЗ (техническое задание)

Входные данные

Файл настроек config.toml в той же папке, что и скрипт.

Секция [[images]]: массив объектов вида:

path — абсолютный путь к картинке (PNG/JPG и т. п.).

duration — длительность показа этой картинки в секундах (дробные значения разрешены).

Допустимые форматы изображений — любые, которые поддерживает FFmpeg (JPEG/PNG/WebP и т. п.).

Выходные данные

Один видеофайл (.mp4 по умолчанию) по пути, указанному в config.toml.

Параметры видео (в config.toml)

output — путь к итоговому видео (абсолютный либо относительный к папке скрипта).

width, height — целевое разрешение (например, 1920×1080).

background — цвет фона при вписывании (HEX #RRGGBB или #RRGGBBAA).

fps — частота кадров (например, 30).

codec — видеокодек (по умолчанию libx264).

crf — качество для libx264 (меньше — лучше; типично 18–23).

preset — пресет кодирования (ultrafast…veryslow).

pixel_format — формат пикселей (yuv420p по умолчанию).

audio — (опционально) путь к аудиофайлу (MP3/WAV/M4A и т. п.) для микса.

audio_offset — (опционально) задержка аудио в секундах (можно отрицательную).

shortest — (bool) если true, длительность ограничивается короче из видео/аудио.

temp_dir, list_filename — служебные временные файлы/папки (создаются автоматически).

log_level — уровень логов FFmpeg (quiet, error, warning, info).

continue_on_error — (bool) продолжать ли при отсутствии отдельных файлов (если false — падать с ошибкой).

Требования к обработке изображений

Сохранить пропорции каждого изображения.

Вписать в width × height, не обрезая (letterbox).

Свободное пространство залить background.

Алгоритм склейки

Генерировать файл списка для concat-демультиплексора FFmpeg:

file 'C:\полный\путь\к\картинке1.png'
duration 3.5
file 'C:\полный\путь\к\картинке2.jpg'
duration 2.0
…


Последнюю картинку повторить ещё раз без duration, чтобы FFmpeg правильно применил длительность последнего слайда.

Запустить FFmpeg с фильтром scale+pad для всех кадров:

scale=width:height:force_original_aspect_ratio=decrease,
pad=width:height:(ow-iw)/2:(oh-ih)/2:color=background


Задать -r (fps), кодек, -pix_fmt yuv420p, -movflags +faststart.

Если указано audio, примиксовать аудиодорожку с учётом audio_offset и shortest.

Ошибки и валидация

Проверять существование всех images[*].path.

Проверять, что duration > 0.

Предупреждать, если путь не абсолютный.

В случае ошибок — понятное сообщение и ненулевой код выхода (если continue_on_error=false).