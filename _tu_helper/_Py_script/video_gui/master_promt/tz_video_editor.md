# ТЗ: настольный GUI на Tkinter для работы с видео (FFmpeg/FFplay)

**Название проекта (папка): `video_editor`**

> Принцип: простой интерфейс, все операции — через установленный FFmpeg/FFplay. Исходники не трогаем, результат — в
> новые файлы. Структуру ТЗ сохраняем; новые пункты встраиваются без лишних правок других разделов.

## Что будет уметь программа

### 1) Просмотр и навигация

- Открыть видео и смотреть его в отдельном окне плеера (ffplay).
- Кнопки: Пуск/Пауза, −10с, +10с, переход к времени `мм:сс`.
- Регулировка громкости и Mute.
- Отображение текущего времени и длительности.

### 2) Лента-«разворотка» по секундам

- Отдельная панель миниатюр **каждой секунды** (скролл).
- Клик по миниатюре — мгновенный переход к этой секунде в плеере.
- Подсказки времени при наведении.

### 3) Скриншоты

- На миниатюрах — чекбоксы «Сохранить кадр».
- Кнопка «Сохранить выбранные» → PNG/JPG с автоименами (например, `video_00-01-23.png`).

### 4) Работа с выделением (фрагмент)

- Задание **Начало** и **Конец** (по ленте или вручную).
- **Удалить выделенное** (остальное автоматически склеивается).
- **Сохранить выделенное в файл** (вырезать клип).
- Режимы резки:
    - **Быстро** — без перекодирования (возможна неточность до ближайшего ключевого кадра).
    - **Точно** — с перекодированием (строго по времени).

### 5) Аудио: удалить / заменить / смешать / нормализовать

- **Удалить звук** у всего видео или только в выделенном фрагменте  
  (варианты: сделать тишину в пределах фрагмента, либо вырезать фрагмент со склейкой).
- **Заменить звук**:
    - **Из файла** — полностью или только на выделенном участке (подгон длительности: обрезать/зациклить).
    - **С микрофона** — запись через FFmpeg с выбранного устройства и вставка полностью/фрагментом.
- **Смешивание**: поверх оригинала добавить новый звук (комментарий) с настройкой уровней и **дукингом** (
  автоприглушение оригинала во время комментария).
- **Нормализация громкости**:
    - Простой режим — быстрое выравнивание.
    - Точный режим — EBU R128 (двухпроходная нормализация) для ровного уровня.

> Примечание: выбор аудиоустройства — Windows (`dshow`), macOS (`avfoundation`), Linux (`pulse/alsa`).

### 6) Шумоподавление

- Кнопка «Убрать шум» — для всего видео или выделенного фрагмента.
- Пресеты: **Лёгкое / Среднее / Сильное**.
- Доп. параметры: подавление «гула» (низкие), смягчение сибилянтов (высокие).
- Если доступна RNNoise-модель — опция «Умное шумоподавление»; иначе классическое спектральное подавление.
- Предпрослушка короткого отрывка перед применением.

### 7) Скорость

- **Ускорить / замедлить** всё видео или только фрагмент.
- Пресеты: 0.5×, 0.75×, 1.25×, 1.5×, 2× + произвольное значение.
- Для звука: режим **сохранить высоту** (без «гелия») или **менять высоту** вместе со скоростью.

### 8) Логотип (прозрачный)

- Загрузка PNG с альфой.
- Позиции: ↖ ↗ ↙ ↘, настраиваемые отступы.
- Автомасштаб (например, 10% ширины кадра).
- Применять к целому видео или только к фрагменту.

### 9) Конвертация / перекодирование

- Перегон в нужный **контейнер/формат**: MP4, MKV, MOV, WEBM, AVI и т.д.
- Профили качества: **Оригинал / Большой / Средний / Маленький файл**.
- Смена **разрешения** (4K→1080p→720p…), совместимый пиксельный формат (yuv420p).
- **Быстрый ремакс** (без перекодирования), если кодеки совместимы.

### 10) Автомонтаж «где ничего не происходит»

- Автоматически убирать «пустые» участки:
    - **По звуку** — тишина ниже порога.
    - **По картинке** — отсутствие движения (почти статичный кадр).
    - **По обоим** — вырезать только если одновременно тишина **и** нет движения.
- Настройки:
    - Порог тишины (чувствительность).
    - Порог движения (чувствительность).
    - **Мин. длина паузы** (не резать слишком короткие).
    - **Запас до/после** (например, по 0.2–0.5 с, чтобы не обрезать слова/жесты).
    - **Перекрёстное затухание** (мягкие швы) на стыках.
- **Предпросмотр**: подсветка предполагаемых вырезаемых сегментов на ленте и список «Начало–Конец».
- Альтернатива вырезке: **«сжать паузы»** — ускорить пустые участки (например, 4×), сохранив ритм.

### 11) Пакетные операции и пресеты

- Очередь задач (одно или много видео).
- Сохранение/загрузка **пресетов** настроек (JSON).
- Прогресс-бар, примерное «Осталось…», лог команд и ошибок.
- Кнопка «Открыть папку» после выполнения.

### 12) Удобства

- Общая **папка вывода** и **шаблон имени**: `{name}_{op}_{start}-{end}.{ext}`.
- Политика при существующих файлах: **Пропустить / Перезаписать / Версионировать** (`file(1).mp4`, `file(2).mp4`).
- Всегда показывать готовую команду FFmpeg (для копирования/отладки).
- Все длительные операции — в отдельных потоках; UI не «фризится».

### 13) Требования и платформа

- Windows/macOS/Linux, **Python 3.8+** с Tkinter.
- Установленные **FFmpeg** и **FFplay** (в PATH или указать путь в настройках).
- Никаких внешних Python-зависимостей.

### 14) Структура проекта и файлы (новое)

- **Требование:** код разбит на отдельные файлы; **максимально простой** стиль и **максимум русских комментариев**.
- Точка входа: **`app_main.py`** (корень проекта).
- Логика и вспомогательные модули — в папке **`tools/`** (можно менять/расширять по мере развития):
    - `tools/ffprobe_info.py` — чтение метаданных (длительность, дорожки, кодеки).
    - `tools/thumbs_timeline.py` — генерация ленты миниатюр по секундам.
    - `tools/player_control.py` — управление ffplay (прыжок ко времени, громкость).
    - `tools/fragment_ops.py` — вырезка/удаление/склейка, точная и быстрая.
    - `tools/audio_ops.py` — удаление/замена/смешивание/нормализация, запись с микрофона.
    - `tools/denoise.py` — шумоподавление (классическое/RNNoise при наличии модели).
    - `tools/speed_ops.py` — изменение скорости, с/без сохранения высоты.
    - `tools/logo_overlay.py` — наложение PNG-логотипа.
    - `tools/convert_ops.py` — конвертация/ремакс/масштабирование.
    - `tools/automontage.py` — поиск тишины/статичности, нарезка или сжатие пауз, предпросмотр.
    - `tools/queue_runner.py` — очередь задач, прогресс, ETA, обработка логов.
    - `tools/presets.py` — сохранение/загрузка JSON-пресетов.
    - `tools/utils.py` — общие утилиты (формат времени, шаблоны имён, проверка путей).
    - `tools/config.py` — хранение настроек (пути к FFmpeg/FFplay, дефолтные пресеты).
- UI строится в `app_main.py` (вкладки/кнопки), вызывает функции из `tools/*`.
- **Важно:** не генерировать код до отдельного указания. Сначала согласовываем ТЗ/структуру.

---

## Вкладки интерфейса

1. **Файлы** — добавление/список, папка вывода.
2. **Просмотр** — плеер-кнопки, переход по времени, **лента миниатюр по секундам**, чекбоксы скриншотов.
3. **Фрагмент** — Начало/Конец, «Удалить выделенное», «Сохранить выделенное», выбор **Быстро/Точно**.
4. **Аудио** — удалить/заменить (файл, микрофон)/смешать/нормализовать, уровни, дукинг.
5. **Шумоподавление** — пресеты, доп. параметры, предпрослушка.
6. **Скорость** — пресеты, произвольное значение, опции высоты звука.
7. **Логотип** — PNG, позиция, масштаб, применить (ко всему/фрагменту).
8. **Конвертация** — формат, качество, разрешение, ремакс.
9. **Автомонтаж** — пороги тишины/движения, мин. пауза, запас, склейки, «сжать паузы», предпросмотр.
10. **Очередь/Статус** — список задач, прогресс, открыть папку, лог.

## Нюансы и ограничения

- **Быстрая резка** без перекодирования — очень быстрая, но может «привязываться» к ключевым кадрам (некадровая
  точность). Для идеальной точности использовать режим перекодирования.
- Запись с микрофона требует, чтобы FFmpeg «видел» аудиоустройство в ОС (обычно доступно по умолчанию).

--- 

*Изменения и дополнения буду внедрять, сохраняя эту структуру и формулировки, если нет веской необходимости что-то
перестроить.*
